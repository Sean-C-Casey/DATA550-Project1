---
title: "Mini Project 1"
author: 'Justine Filion and Sean Casey'
date: "January 28 2022"
output:
  html_document:
    df_print: paged
  pdf_document: default
---

```{r eval=TRUE, echo=FALSE, include=FALSE}
#install.packages("dplyr")
library(dplyr)

#install.packages("knitr")
library(knitr)

#install.packages("devtools")
library(devtools)

#install.packages("DT")
library(DT)

#install.packages("xtable")
library(xtable)

library(tidyverse)

# install.packages('caret')
library(caret)

library(readxl)

library(ggplot2)

# install.packages('arulesCBA')
library(arulesCBA)
```

# Step 1 : Describe the Dataset

The data used in the following analysis was provided to us by the Department of Information Management from Chung Hua University and the Department of Civil Engineering from Tamkang University which are both located in Taiwan. It was donated as of January 26th 2016 but refers to data collected from April to September 2005. The purpose of this dataset is to provide insight on what explanatory variables are correlated with the default of a payment?? (or predicting the probability of default). It contains 23 explanantory variables, all of which are integers, as well as a response variable which takes a value of 1 if there was default and 0 if not. This dataset was made available to us via the UCI Machine Learning Repository which can be accessed through this link : [link](https://archive.ics.uci.edu/ml/machine-learning-databases/00350/). 

# Step 2 : Load the Dataset

```{r}
df <- read_excel('defaultofcreditcardclients.xls', skip = 1)
```

# Step 3 : Explore the Dataset

```{r}
str(df)

summary(df)

sapply(3:5, function(x) table(df[,x])) # Sex, Education, Marriage

# ggplot(data =df, aes(AGE)) + geom_bar()
```
# Step 4 : Initial Thoughts

* Why are there 0, 5 and 6s for Education if supposed to be from 1 to 4 --> put them in 4 = others ?
* Why is there 0 for Marital status if supposed to be from 1 to 3 --> put it in 3 = others ?
* Make column to count the amount of times the client defaulted (evaluate how good/bad of a credit the client has)

# Step 5 : Wrangling

For the `Education` variable, the data description does not mention what 0, 5 and 6 represent. For our analysis, we chose to classify these values as others and so attributed them the value 4. We also thought it would be interesting to add a column that represented the number of months out of the 6 included in the data where the client defaulted. To do this, we calculated the number of months out of the 6 where a payment was delayed (values from 1 to 9 in columns PAY_SEP through PAY_APR). Another column called `REVOLVING_CREDIT` was added. It counts the number of months where a client was offered revolving credit and 0 if not. Finally, we decided to discretize the age variable. We created the following age intervals :  [20, 30), [30, 40), [40, 50), [50, 60), [60, 70), [70, 80) and [80, 90).


```{r}
# Move everything not in HighSchool, Undergrad, or GradSchool to Other category
df[df$EDUCATION %in% c(0, 5, 6), "EDUCATION"] <- 4

# Count number of times defaulted on monthly paymnt, and number of times offered
# revolving credit within the 6-month observation period
for (i in 1:nrow(df)){
  default_count <- 0
  revolving_credit_count <- 0
  for (j in 7:12){
    if (df[i, j] > 0) {
      default_count <- default_count + 1
    } else if (df[i, j] == 0) {
      revolving_credit_count <- revolving_credit_count + 1
    }
  }
  df[i, 'QTY_DEFAULT'] <- default_count
  df[i, 'REVOLVING_CREDIT'] <- revolving_credit_count
}

# Discretize age by making bins (20s, 30s, etc.)
df$AGE_BINNED <- cut(df$AGE, breaks = c(20, 30, 40, 50, 60, 70, 80, 90), include.lowest = TRUE)
```


# Step 6 : Research Questions

1- Are the people with a higher education (graduate school, university), on average, default less frequently than people with a lower level of education (high school)?

2- Are the people who are given higher amounts of credit, also people who, on average, default less frequently?

3- Are the people who are married, on average, default less frequently than people who are single? 

4- Are people who are given revolving credit also given a higher amount of credit?

5- Are people who are given revolving credit tend to be people who are older? Married? 

6- Are people who have defaulted more than once in the past 6 months more likely to default in October (Y column)?
 

# Step 7 : Data Analysis & Visualizations
```{r}
ggplot(df) +
  aes(x = `QTY_DEFAULT`) +
  geom_histogram(binwidth = 1, fill = "dodgerblue4") +
  ggtitle("Occurences of Payment Default within a 6-month Period") +
  labs(x = "Payment Default Occurences", y = "Count") +
  theme_minimal()
```
For this visualization, we opted for a simple histogram because all we wanted to 
accomplish here was to show the distribution of the number of missed payments 
within the 6-month observation period.

```{r}
# aggregate(df$QTY_DEFAULT, by=list(df$EDUCATION), FUN=mean)
default_by_education  <- df %>% group_by(`EDUCATION`) %>% summarise(mean_default = mean(`QTY_DEFAULT`))
default_by_education$EDUCATION <- factor(
  default_by_education$EDUCATION, 
  levels = c(1, 2, 3, 4),
  labels = c("Graduate", "Undergraduate", "High School", "Other")
)

ggplot(default_by_education) +
  aes(x = reorder(`EDUCATION`, -`mean_default`), y = `mean_default`, fill = `EDUCATION`) +
  geom_bar(show.legend = FALSE, stat="identity", position="dodge") +
  geom_text(aes(label=sprintf("%.2f", `mean_default`)), position=position_dodge(width = 0.2), vjust=-0.5) +
  ggtitle("Mean Number of Payment Defaults by Education Level") +
  labs(x = "Education", y = "Mean default Count") +
  theme_minimal()
```
For this visualization, we chose to use a bar chart so we could easily see which
Education group had the highest average number of defaults, and so we could
quickly compare the different groups to each other.

```{r}
ggplot(df) +
  aes(x = `EDUCATION`) +
  geom_histogram(binwidth = 1, fill = "dodgerblue4") +
  ggtitle("Distribution of Education Levels") +
  labs(x = "Education Levels", y = "Count") +
  theme_minimal()
```
We chose a histogram for this visualization because, again, we just wanted to 
see the distribution of the different education levels within the data.

```{r}
# df %>% group_by(`QTY_DEFAULT`) %>% summarise(pop_count = mean(`AGE`))
zero_count <- count(df, QTY_DEFAULT)[[1,2]]
zero_default_education <- df %>% filter(QTY_DEFAULT == 0) %>% count(EDUCATION)
zero_default_education$EDUCATION <- factor(
  zero_default_education$EDUCATION, 
  levels = c(1, 2, 3, 4),
  labels = c("Graduate", "Undergraduate", "High School", "Other")
)
zero_default_education$fraction <- zero_default_education$n / zero_count
zero_default_education$ymax <- cumsum(zero_default_education$fraction)
zero_default_education$ymin <- c(0, head(zero_default_education$ymax, n=-1))
zero_default_education$labelPosition <- (zero_default_education$ymax + zero_default_education$ymin) / 2
```
```{r}
ggplot(zero_default_education) +
  aes(ymax=ymax, ymin=ymin, xmax=5, xmin=4, fill=EDUCATION) +
  geom_rect() +
  geom_label(
    x = 5.35, 
    aes(y=labelPosition, label=sprintf("%.1f%%", fraction * 100)), 
    show.legend = FALSE
  ) +
  coord_polar(theta = "y") +
  xlim(c(3,5)) +
  ggtitle("Education of people who have never defaulted") +
  labs(fill = "Education") +
  theme_void()
  # theme(legend.position = "none")
```
For this visualization, we opted for a donut chart, because we wanted to 
visualize the proportional breakdown by education of people who've never 
defaulted, and a donut chart is considered a good choice for displaying 
proportions.

```{r}
six_count <- count(df, QTY_DEFAULT)[[7,2]]
six_default_education <- df %>% filter(QTY_DEFAULT == 6) %>% count(EDUCATION)
six_default_education$EDUCATION <- factor(
  six_default_education$EDUCATION,
  levels = c(1, 2, 3, 4),
  labels = c("Graduate", "Undergraduate", "High School", "Other")
)
six_default_education$fraction <- six_default_education$n / six_count
six_default_education$ymax <- cumsum(six_default_education$fraction)
six_default_education$ymin <- c(0, head(six_default_education$ymax, n=-1))
six_default_education$labelPosition <- (six_default_education$ymax + six_default_education$ymin) / 2
```
```{r}
ggplot(six_default_education) +
  aes(ymax=ymax, ymin=ymin, xmax=5, xmin=4, fill=EDUCATION) +
  geom_rect() +
  geom_label(
    x = 5.35, 
    aes(y=labelPosition, label=sprintf("%.1f%%", fraction * 100)), 
    show.legend = FALSE
  ) +
  coord_polar(theta = "y") +
  xlim(c(3,5)) +
  ggtitle("Education of people who have defaulted every month") +
  labs(fill = "Education") +
  theme_void()
```
For this visualization, we opted for a donut chart, because we wanted to 
visualize the proportional breakdown by education of people who've defaulted 
every month, and a donut chart is considered a good choice for displaying 
proportions.

## Research Questions

1. Is there a relationship between income of an individual, and the number 
of times within the 6-month observation period that they default? (Answering 
this question would requite a dataset that includes all the columns of the
current dataset, plus columns for net monthly income)

2. 

# step 8 : Summary and Conclusions

We've found that a sizeable majority of the people surveyed in this dataset 
didn't default even a single time within the 6-month observation period in
which the data was collected. 

An undergraduate education was the most common educational level achieved by the
people in this dataset, followed by graduate school, then high school, and other
forms of education the least common. This same approximate proportion was also 
observed in the group of people who never defaulted on their payments. 

















